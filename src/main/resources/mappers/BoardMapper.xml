<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BoardMapper">

    <!-- Beans의 멤버변수(property)이름과 대상 테이블의 컬럼(column)을 연결한다. -->
    <resultMap id="boardMap"
        type="kr.co.wesellglobal.sellermatch.model.BoardDto">
        <result property="boardIdx"   column="board_idx" />
        <result property="boardId"     column="board_id" />
        <result property="boardTitle"   column="board_title" />
        <result property="boardContents" column="board_contents" />
        <result property="boardWriter" column="board_writer" />
        <result property="boardType" column="board_type" />
        <result property="boardQaType" column="board_qa_type" />
         <result property="boardEmail" column="board_email" />
         <result property="boardHit" column="board_hit" />
         <result property="boardRegDate" column="board_reg_date" />
         <result property="boardEditDate" column="board_edit_date" />
         <result property="replyCount" column="reply_count" />
    </resultMap>
    
    <insert id="insertItem"
    	parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto"
    	useGeneratedKeys="true"
    	keyProperty="boardIdx">
    	INSERT INTO BoardList
    		(`board_id`, `board_title`, `board_contents`, `board_writer`, `board_type`, `board_qa_type`, 
    		`board_email`, `board_hit`, `board_reg_date`)
    	 VALUES 
    	 	(#{boardId}, #{boardTitle}, #{boardContents}, #{boardWriter}, #{boardType}, 
    	 	#{boardQaType}, #{boardEmail}, 0, now());
    </insert>
    
    <select id="selectList"
    	parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto"
    	resultMap="boardMap">
    	SELECT 
	   		b.board_idx, b.board_id, b.board_title, b.board_contents, b.board_writer, b.board_type, b.board_qa_type, b.board_email, b.board_hit, 
	   		b.board_reg_date, b.board_edit_date, (SELECT COUNT(*) FROM ReplyList where Reply_board_id = b.Board_id) as reply_count
	   		FROM BoardList b
    	<where>
    		<if test="boardType != null and boardType != ''">
    			board_type = #{boardType}
    		</if>
			<if test="boardTitle != null and boardTitle != ''">
				OR board_title LIKE concat('%', #{boardTitle}, '%')
			</if>
			<if test="boardContents != null and boardContents != ''">
				OR board_contents LIKE concat('%', #{boardContents}, '%')
			</if>
			<if test="boardWriter != null and boardWriter != ''">
				OR board_writer LIKE concat('%', #{boardWriter}, '%')
			</if>
		</where>
    	
    	<if test="listCount > 0">
			LIMIT #{offset}, #{listCount}
		</if>
    </select>
    
    <select id="selectItem"
    	parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto"
    	resultMap="boardMap">
    	SELECT 
    		board_idx, board_id, board_title, board_contents, board_writer, board_type, board_qa_type, board_email, board_hit, 
	   		board_reg_date, board_edit_date
    	FROM BoardList
    </select>

	<update id="updateItem"
		parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto">
		UPDATE BoardList
		SET
			board_title = #{boardTitle}, 
			board_contents=#{boardContents}, 
			board_writer = #{boardWriter}, 
			board_type = #{boardType}, 
			board_qa_type = #{boardQaType}, 
			board_email = #{boardEmail}, 
			board_hit = #{boardHit}, 
			board_edit_date = now()
		WHERE board_id = #{boardId}
	</update>
	
	<!-- 게시판조회 데이터 수 조회 -->
	<select id="selectCountAll"
		parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto"
		resultType="int">
		SELECT COUNT(*)
		FROM BoardList
		<where>
			<if test="boardType != null and boardType != ''">
    			board_type = #{boardType}
    		</if>
			<if test="boardTitle != null and boardTitle != ''">
				OR board_title LIKE concat('%', #{boardTitle}, '%')
			</if>
			<if test="boardContents != null and boardContents != ''">
				OR board_contents LIKE concat('%', #{boardContents}, '%')
			</if>
			<if test="boardWriter != null and boardWriter != ''">
				OR board_writer LIKE concat('%', #{boardWriter}, '%')
			</if>
		</where>
	</select>
	
	<delete id="deleteItem"
		parameterType="kr.co.wesellglobal.sellermatch.model.BoardDto">
        DELETE FROM BoardList
        <where>
            board_id IN 
            <foreach collection="idArr" item="item" index="index" open="(" close=")" separator=",">
                #{item}
            </foreach>
        </where>		
	</delete>
</mapper>